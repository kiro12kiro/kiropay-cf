document.addEventListener("DOMContentLoaded", () => {
  // --- Ù…Ø³Ùƒ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---
  // ( ... Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ ... )
  
  // --- Ø¹Ù†Ø§ØµØ± Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ---
  // ( ... Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ ... )
  const adminFamilyMessage = document.getElementById("admin-family-message");
  
  // ğŸ›‘ğŸ›‘ Ø¹Ù†Ø§ØµØ± ÙÙˆØ±Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ğŸ›‘ğŸ›‘
  const adminQuizForm = document.getElementById("admin-quiz-form");
  const adminQuizMessage = document.getElementById("admin-quiz-message");
  
  // ( ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ ... )
  
  // --- ÙÙˆØ±Ù… Ø§Ù„Ù„ÙˆØ¬Ù† (Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ) ---
  loginForm.addEventListener("submit", async (event) => {
    // ( ... Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
  });

  // --- ÙØ§Ù†ÙƒØ´Ù† Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª (Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ) ---
  async function loadTransactionHistory(email) {
    // ( ... Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
  }

  // --- ÙØ§Ù†ÙƒØ´Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© (Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ) ---
  async function loadLeaderboards() {
    // ( ... Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
  }

  // --- ÙØ§Ù†ÙƒØ´Ù† Ù…Ø³Ø§Ø¹Ø¯Ø© (Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ) ---
  async function populateFamilyList(familyName, listElement) {
    // ( ... Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
  }

  // --- ÙÙˆØ±Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Signup) (Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ) ---
  signupForm.addEventListener("submit", async (event) => {
      // ( ... Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
  });


  // --- Ø²Ø±Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ (Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ) ---
  logoutBtn.addEventListener("click", () => {
    // ( ... Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
  });


  // --- ÙƒÙˆØ¯ "ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©" (Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ) ---
  avatarUploadInput.addEventListener("change", async () => {
      // ( ... Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
  });


  // 
  // --- Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† (Ù…ÙØ¹Ø¯Ù„Ø©) ---
  // 
  (function setupAdminPanel() {
      // ( ... ÙƒÙˆØ¯ ÙÙˆØ±Ù… Ø§Ù„Ø¨Ø­Ø« Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
      // ( ... ÙƒÙˆØ¯ ÙØ§Ù†ÙƒØ´Ù† Ù…Ù„Ø¡ Ø§Ù„ÙƒØ§Ø±Øª Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
      // ( ... ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø±ÙˆØ¨ Ù„ÙŠØ³Øª Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
      // ( ... ÙƒÙˆØ¯ ÙØ§Ù†ÙƒØ´Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
      // ( ... ÙƒÙˆØ¯ Ø²Ø±Ø§ÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
      // ( ... ÙƒÙˆØ¯ Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )
      // ( ... ÙƒÙˆØ¯ Ø²Ø±Ø§ÙŠØ± Ø§Ù„Ø£Ø³Ø± Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ... )

      // ğŸ›‘ğŸ›‘ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ÙÙˆØ±Ù… Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ğŸ›‘ğŸ›‘
      adminQuizForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        adminQuizMessage.textContent = "Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„...";
        adminQuizMessage.style.color = "blue";

        // 1. Ù„Ù… ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙÙˆØ±Ù…
        const data = {
          question: document.getElementById("quiz-question").value,
          opt_a: document.getElementById("quiz-opt-a").value,
          opt_b: document.getElementById("quiz-opt-b").value,
          opt_c: document.getElementById("quiz-opt-c").value,
          correct_opt: document.getElementById("quiz-correct-opt").value,
          points: document.getElementById("quiz-points").value,
        };

        try {
          // 2. ÙƒÙ„Ù… Ø§Ù„Ù€ API Ø§Ù„Ø¬Ø¯ÙŠØ¯
          const response = await fetch(`/admin-create-quiz`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (response.ok) {
            adminQuizMessage.textContent = result.message;
            adminQuizMessage.style.color = "green";
            adminQuizForm.reset(); // ÙØ¶ÙŠ Ø§Ù„ÙÙˆØ±Ù…
          } else {
            adminQuizMessage.textContent = `ÙØ´Ù„: ${result.error}`;
            adminQuizMessage.style.color = "red";
          }
        } catch (err) {
          adminQuizMessage.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ API.";
          adminQuizMessage.style.color = "red";
        }
      });
      // ğŸ›‘ğŸ›‘ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ›‘ğŸ›‘

  })(); // ğŸ›‘ Ù†Ù‡Ø§ÙŠØ© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† ğŸ›‘

}); // Ù†Ù‡Ø§ÙŠØ© "DOMContentLoaded"
